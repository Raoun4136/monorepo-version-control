# ìë™ìœ¼ë¡œ PRì— ë³€ê²½ëœ Commitì„ ì¶”ê°€í•˜ëŠ” Workflow
name: Write Commits to PR body

on:
  pull_request_target:
    types:
      - opened # ì‹œì  ë¬¸ì œë¡œ openì‹œì—ë§Œ íŠ¸ë¦¬ê±°í•œë‹¤.

permissions:
  contents: write
  pull-requests: write

jobs:
  write_on_pr_body:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Write Commits to PR body
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Mergeë¡œ ì‹œì‘ë˜ì§€ ì•Šê³  PRì— í¬í•¨ëœ ì»¤ë°‹ ë©”ì„¸ì§€ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
          MESSAGES=$(gh pr view ${{ github.event.pull_request.number }} --json commits --jq '.commits[] | select(.messageHeadline | startswith("Merge") | not) | .messageHeadline')

          # ê¸°ì¡´ PR bodyë¥¼ ê°€ì ¸ì˜¨ë‹¤.
          PR_BODY=$(gh pr view ${{ github.event.pull_request.number }} --json body --jq '.body')

          # "ğŸ“ Changes on this Pull Request" ë¼ì¸ ì•„ë˜ì— ì»¤ë°‹ ì œëª©ì„ ì¶”ê°€í•œë‹¤.
          UPDATED_PR_BODY=$(echo "$PR_BODY" | sed "/ğŸ“ Changes on this Pull Request/a\\ $MESSAGES")

          # ë³¸ë¬¸ ì—…ë°ì´íŠ¸
          gh pr edit ${{ github.event.pull_request.number }} --body "$UPDATED_PR_BODY"
